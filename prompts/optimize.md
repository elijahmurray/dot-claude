# Optimize Performance

Please analyze and optimize the performance of this code:

1. **Performance Analysis**
   - Identify bottlenecks
   - Check for N+1 queries
   - Analyze time/space complexity

2. **Optimization Strategies**
   - Algorithm improvements
   - Caching implementation
   - Database query optimization
   - Lazy loading where appropriate

3. **Memory Management**
   - Reduce memory allocations
   - Fix memory leaks
   - Optimize data structures

4. **Measurement**
   - Add performance benchmarks
   - Compare before/after metrics
   - Document performance gains

Please profile the code first, then apply optimizations with explanations.